<div class="admin-wrap">
  <h1>Loans</h1>
  <p class="muted">Active, overdue, and returned loans.</p>

  <form class="filters" [formGroup]="filter">
    <input formControlName="q" type="text" placeholder="Search user/email/title" />
    <select formControlName="status">
      <option>All</option>
      <option>Active</option>
      <option>Overdue</option>
      <option>Returned</option>
    </select>
    <button type="button" (click)="load()" [disabled]="loading">Refresh</button>
  </form>

  <div *ngIf="error" class="error">{{ error }}</div>
  <div *ngIf="loading" class="muted">Loading…</div>

  <table class="tbl" *ngIf="!loading">
    <thead>
      <tr>
        <th>Book</th>
        <th>User</th>
        <th>Loan date</th>
        <th>Due</th>
        <th>Status</th>
        <th style="width:1%"></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let l of filtered" [class.overdue]="l.status==='Overdue'">
        <td>{{ l.bookTitle }}</td>
        <td>
          <div>{{ l.userName || '—' }}</div>
          <small class="muted">{{ l.userEmail }}</small>
        </td>
        <td>{{ l.loanDate | date:'yyyy-MM-dd' }}</td>
        <td>{{ l.dueDate  | date:'yyyy-MM-dd' }}</td>
        <td>
          <span class="pill" [class.pill-overdue]="l.status==='Overdue'"
                            [class.pill-returned]="l.status==='Returned'">
            {{ l.status }}
          </span>
        </td>
        <td>
          <button *ngIf="l.status!=='Returned'" (click)="markReturned(l)">Mark returned</button>
        </td>
      </tr>
      <tr *ngIf="filtered.length===0">
        <td colspan="6" class="muted">No loans.</td>
      </tr>
    </tbody>
  </table>
</div>
